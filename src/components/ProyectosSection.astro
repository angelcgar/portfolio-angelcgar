---
import { getProjectData } from '../lib/api';

const categorias = [
  'Web Application',
  'Juegos',
  'Dashboard',
  'E-commerce',
  'Backend',
] as const;

const proyectos = await getProjectData();
---

<section id="proyectos" class="py-20 bg-dark">
  <div class="container px-4 mx-auto">
    <h2 class="mb-12 text-3xl font-bold text-center">
      Mis <span class="text-accent">Proyectos</span>
    </h2>

    <!-- Filter buttons -->
    <div class="flex flex-wrap justify-center gap-2 mb-10">
      <button
        class="px-4 py-1 text-sm font-medium transition-colors duration-300 rounded-full cursor-pointer bg-accent text-darker filter-btn active"
        data-filter="all"
      >
        Todos los proyectos
      </button>

      {
        categorias.map((cat) => (
          <button
            class="px-4 py-1 text-sm transition-colors duration-300 rounded-full cursor-pointer bg-darker text-light hover:bg-dark hover:text-accent filter-btn"
            data-filter={cat}
          >
            {cat}
          </button>
        ))
      }
    </div>

    <!-- Projects grid -->
    <div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
      {
        proyectos.map((proyecto) => (
          <div
            class="bg-darker rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 hover:translate-y-[-5px] proyecto-card"
            data-category={proyecto.category}
            data-important={proyecto.isImportant ? 'true' : 'false'}
          >
            <div class="relative h-48 overflow-hidden">
              <img
                src={proyecto.image}
                alt={proyecto.title}
                class="object-cover w-full h-full transition-transform duration-500 hover:scale-110 hover:cursor-crosshair"
              />
            </div>
            <div class="p-6">
              <a href={`/proyectos/${proyecto.name}`}>
                <h3 class="inline-block mb-2 text-xl font-semibold underline hover:text-accent">
                  {proyecto.title}
                </h3>
              </a>
              <div class="flex flex-wrap gap-2 mb-4">
                {proyecto.technologies.map((tech) => (
                  <span class="px-2 py-1 text-xs rounded bg-dark text-secondary-foreground">
                    {tech}
                  </span>
                ))}
              </div>
              <div class="flex items-center justify-between">
                <a href="#" class="inline-flex items-center text-sm ">
                  <span class="mr-1">Código</span>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-4 h-4"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5"
                    />
                  </svg>
                </a>
                <a
                  href="#"
                  class="px-3 py-1 text-sm transition-colors duration-300 rounded bg-accent text-darker hover:bg-accent/90"
                >
                  Demo
                </a>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<script>
  // Projects filtering
  const filterBtns =
    document.querySelectorAll<HTMLButtonElement>('.filter-btn');
  const projectCards =
    document.querySelectorAll<HTMLDivElement>('.proyecto-card');

  // Para todos los botones, les ponemos el evento de click
  filterBtns.forEach((btn) => {
    btn.addEventListener('click', () => {
      // Update active button
      // Actualizamos los botones a como se vallan haciendo click
      filterBtns.forEach((b) =>
        b.classList.remove('active', 'bg-accent', 'text-darker'),
      );
      filterBtns.forEach((b) =>
        b.classList.add(
          'bg-darker',
          'text-light',
          'hover:bg-dark',
          'hover:text-accent',
        ),
      );
      // Activamos el botón que se ha hecho click
      // y le quitamos las clases de hover
      btn.classList.add('active', 'bg-accent', 'text-darker');
      btn.classList.remove(
        'bg-darker',
        'text-light',
        'hover:bg-dark',
        'hover:text-accent',
      );

      // Recuperamos el filtro del botón que se ha hecho click
      const filter = btn.getAttribute('data-filter');

      projectCards.forEach((card) => {
        if (filter === 'important') {
          console.log('important');
          console.log({ filter, category: card.getAttribute('data-category') });
          // Si el filtro es "important", mostramos solo los proyectos importantes
          if (card.getAttribute('data-important') === 'true') {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
          // card.style.display = 'block';
          return;
        } else if (card.getAttribute('data-category') === filter) {
          console.log('other projects');
          card.style.display = 'block';
          return;
        } else {
          console.log('error');
          console.log({ filter, category: card.getAttribute('data-category') });
          card.style.display = 'none';
        }
      });
    });
  });

  const filterImportantBtn = document.getElementById(
    'filter-important',
  ) as HTMLButtonElement;
  if (filterImportantBtn) {
    filterImportantBtn.click(); // Simula un click inicial para mostrar los proyectos importantes
  }
</script>
